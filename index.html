import React, { useState } from 'react';
import { Shield, AlertTriangle, CheckCircle, TrendingUp, Clock, Users, Lock, Activity } from 'lucide-react';

const CyberSecurityDashboard = () => {
  const [selectedCategory, setSelectedCategory] = useState('all');

  const kpiData = [
    {
      category: 'Information Security',
      kpis: [
        { name: 'Security incidents per month', target: '≤ 5', current: 3, status: 'green', unit: 'incidents', icon: Shield },
        { name: 'Employees completing cybersecurity training', target: '≥ 90%', current: 92, status: 'green', unit: '%', icon: Users },
        { name: 'Avg. time to resolve incidents', target: '≤ 3', current: 2.5, status: 'green', unit: 'days', icon: Clock },
        { name: 'Vulnerabilities identified vs. remediated', target: '100%', current: 97, status: 'green', unit: '%', icon: CheckCircle }
      ]
    },
    {
      category: 'Incident Response',
      kpis: [
        { name: 'Mean Time to Identify (MTTI)', target: '≤ 24', current: 18, status: 'green', unit: 'hours', icon: Activity },
        { name: 'Mean Time to Resolve (MTTR)', target: '≤ 72', current: 65, status: 'green', unit: 'hours', icon: Clock },
        { name: 'High-severity incidents per quarter', target: '≤ 2', current: 1, status: 'green', unit: 'incidents', icon: AlertTriangle }
      ]
    },
    {
      category: 'Data Protection (GDPR)',
      kpis: [
        { name: 'GDPR compliance score', target: '100%', current: 98, status: 'green', unit: '%', icon: Lock },
        { name: 'Data breaches reported to authorities', target: '0', current: 0, status: 'green', unit: 'breaches', icon: Shield },
        { name: 'Data retention compliance rate', target: '100%', current: 96, status: 'green', unit: '%', icon: CheckCircle }
      ]
    },
    {
      category: 'Overall Cybersecurity',
      kpis: [
        { name: 'Cybersecurity maturity level', target: 'Level 3+', current: 4, status: 'green', unit: 'level', icon: TrendingUp },
        { name: 'Critical assets with adequate security', target: '≥ 95%', current: 97, status: 'green', unit: '%', icon: Shield },
        { name: 'Cybersecurity budget utilization (ROI)', target: '≥ 90%', current: 88, status: 'amber', unit: '%', icon: TrendingUp },
        { name: 'Awareness campaigns per year', target: '≥ 4', current: 5, status: 'green', unit: 'campaigns', icon: Users }
      ]
    }
  ];

  const getStatusColor = (status) => {
    switch(status) {
      case 'green': return 'bg-green-500';
      case 'amber': return 'bg-yellow-500';
      case 'red': return 'bg-red-500';
      default: return 'bg-gray-500';
    }
  };

  const getStatusBg = (status) => {
    switch(status) {
      case 'green': return 'bg-green-50 border-green-200';
      case 'amber': return 'bg-yellow-50 border-yellow-200';
      case 'red': return 'bg-red-50 border-red-200';
      default: return 'bg-gray-50 border-gray-200';
    }
  };

  const calculateProgress = (kpi) => {
    if (kpi.unit === '%') return kpi.current;
    if (kpi.name.includes('maturity')) return (kpi.current / 5) * 100;
    return Math.min((kpi.current / parseInt(kpi.target.replace(/[^0-9]/g, '') || 100)) * 100, 100);
  };

  const filteredData = selectedCategory === 'all' 
    ? kpiData 
    : kpiData.filter(cat => cat.category === selectedCategory);

  const overallHealth = () => {
    const allKpis = kpiData.flatMap(cat => cat.kpis);
    const green = allKpis.filter(k => k.status === 'green').length;
    const amber = allKpis.filter(k => k.status === 'amber').length;
    const red = allKpis.filter(k => k.status === 'red').length;
    return { green, amber, red, total: allKpis.length };
  };

  const health = overallHealth();

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="mb-8">
          <div className="flex items-center justify-between mb-6">
            <div>
              <h1 className="text-4xl font-bold text-white mb-2 flex items-center gap-3">
                <Shield className="w-10 h-10 text-blue-400" />
                Cybersecurity KPI Dashboard
              </h1>
              <p className="text-slate-400">Real-time monitoring and performance tracking</p>
            </div>
            <div className="text-right">
              <div className="text-sm text-slate-400">Last Updated</div>
              <div className="text-white font-semibold">{new Date().toLocaleString()}</div>
            </div>
          </div>

          {/* Overall Health Summary */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
              <div className="text-slate-400 text-sm mb-2">Total KPIs</div>
              <div className="text-3xl font-bold text-white">{health.total}</div>
            </div>
            <div className="bg-green-900/30 rounded-xl p-6 border border-green-700">
              <div className="text-green-400 text-sm mb-2">Good Status</div>
              <div className="text-3xl font-bold text-green-400">{health.green}</div>
            </div>
            <div className="bg-yellow-900/30 rounded-xl p-6 border border-yellow-700">
              <div className="text-yellow-400 text-sm mb-2">Warning Status</div>
              <div className="text-3xl font-bold text-yellow-400">{health.amber}</div>
            </div>
            <div className="bg-red-900/30 rounded-xl p-6 border border-red-700">
              <div className="text-red-400 text-sm mb-2">Poor Status</div>
              <div className="text-3xl font-bold text-red-400">{health.red}</div>
            </div>
          </div>

          {/* Category Filter */}
          <div className="flex gap-2 flex-wrap">
            <button
              onClick={() => setSelectedCategory('all')}
              className={`px-4 py-2 rounded-lg font-medium transition-all ${
                selectedCategory === 'all'
                  ? 'bg-blue-600 text-white'
                  : 'bg-slate-800 text-slate-300 hover:bg-slate-700'
              }`}
            >
              All Categories
            </button>
            {kpiData.map(cat => (
              <button
                key={cat.category}
                onClick={() => setSelectedCategory(cat.category)}
                className={`px-4 py-2 rounded-lg font-medium transition-all ${
                  selectedCategory === cat.category
                    ? 'bg-blue-600 text-white'
                    : 'bg-slate-800 text-slate-300 hover:bg-slate-700'
                }`}
              >
                {cat.category}
              </button>
            ))}
          </div>
        </div>

        {/* KPI Cards */}
        {filteredData.map(category => (
          <div key={category.category} className="mb-8">
            <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
              <div className="w-1 h-8 bg-blue-500 rounded"></div>
              {category.category}
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4">
              {category.kpis.map((kpi, idx) => {
                const Icon = kpi.icon;
                const progress = calculateProgress(kpi);
                return (
                  <div
                    key={idx}
                    className={`rounded-xl p-6 border-2 transition-all hover:shadow-xl hover:scale-105 ${getStatusBg(kpi.status)}`}
                  >
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex-1">
                        <div className="flex items-center gap-2 mb-2">
                          <Icon className="w-5 h-5 text-slate-600" />
                          <h3 className="font-semibold text-slate-800 text-sm">{kpi.name}</h3>
                        </div>
                        <div className="text-xs text-slate-600">Target: {kpi.target}</div>
                      </div>
                      <div className={`w-3 h-3 rounded-full ${getStatusColor(kpi.status)}`}></div>
                    </div>

                    <div className="mb-3">
                      <div className="flex items-end gap-2 mb-2">
                        <span className="text-3xl font-bold text-slate-800">
                          {kpi.current}
                        </span>
                        <span className="text-slate-600 mb-1">{kpi.unit}</span>
                      </div>
                    </div>

                    {/* Progress Bar */}
                    <div className="w-full bg-slate-200 rounded-full h-2 overflow-hidden">
                      <div
                        className={`h-full ${getStatusColor(kpi.status)} transition-all duration-500`}
                        style={{ width: `${Math.min(progress, 100)}%` }}
                      ></div>
                    </div>

                    {/* Status Badge */}
                    <div className="mt-3 flex justify-between items-center">
                      <span className={`text-xs font-medium px-2 py-1 rounded-full ${
                        kpi.status === 'green' ? 'bg-green-200 text-green-800' :
                        kpi.status === 'amber' ? 'bg-yellow-200 text-yellow-800' :
                        'bg-red-200 text-red-800'
                      }`}>
                        {kpi.status === 'green' ? '✓ Good' : 
                         kpi.status === 'amber' ? '⚠ Warning' : 
                         '✗ Poor'}
                      </span>
                      <span className="text-xs text-slate-600">{Math.round(progress)}% of target</span>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        ))}

        {/* Legend */}
        <div className="mt-8 bg-slate-800 rounded-xl p-6 border border-slate-700">
          <h3 className="text-white font-semibold mb-4">Status Indicators</h3>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="flex items-center gap-3">
              <div className="w-4 h-4 rounded-full bg-green-500"></div>
              <div>
                <div className="text-white font-medium">Green (Good)</div>
                <div className="text-slate-400 text-sm">Meeting or exceeding targets</div>
              </div>
            </div>
            <div className="flex items-center gap-3">
              <div className="w-4 h-4 rounded-full bg-yellow-500"></div>
              <div>
                <div className="text-white font-medium">Amber (Warning)</div>
                <div className="text-slate-400 text-sm">Below target, needs attention</div>
              </div>
            </div>
            <div className="flex items-center gap-3">
              <div className="w-4 h-4 rounded-full bg-red-500"></div>
              <div>
                <div className="text-white font-medium">Red (Poor)</div>
                <div className="text-slate-400 text-sm">Significantly below target</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default CyberSecurityDashboard;
